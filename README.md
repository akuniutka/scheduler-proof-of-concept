# Scheduler Service

Демонстрация быстрой проверки слотов на пересечение с имеющимися бронированиями.

> [!NOTE]
> Для того, чтобы приложение работало в одном часовом поясе с базой данных, при запуске необходимо указать для JVM
> ключ user.timezone со значением UTC

При запуске приложения автоматически создаётся:
- два тестовых пользователя, 
- для каждого из них — по два тестовых события,
- для каждого из событий — по 1 000 000 бронирований, распределённых случайным образом,
- для события 1 создаётся 4 000 000 слотов, с датой и временем начала и окончания совпадающими с указанными 4 000 000 
бронирований (соответственно, половина слотов считается занятыми, так как есть соответствующее им по времени
бронирование для события, где организатором выступает пользователь 1).

### Проверка выбранного пользователем слота

Для того, чтобы проверить, пересекается ли конкретный слот с каким-то из существующих бронирований организатора события,
необходимо отправить отправить запрос следующего формата на ендпоинт POST http://localhost:8081/slots/check
```json
{
    "eventId": 1,
    "startTime": "2025-07-22 05:30",
    "endTime": "2025-07-22 06:15"
}
```

Если для данного слота есть пересечение с каким-либо из существующих бронирований организатора событий, в ответе будет 
приведён пример такого бронирования:
```json
{
  "hasIntersection": true,
  "booking": {
    "id": 3,
    "eventId": 3,
    "ownerId": 1,
    "startTime": "2025-07-22T05:30:00Z",
    "endTime": "2025-07-22T06:15:00Z"
  },
  "timeSpent": 44
}
```

Также в ответе справочно приводится время, затраченное на проверку (в миллисекундах).

### Получение списка свободных слотов

> [!NOTE]
> Проверка на пересечение осуществляется для первых 100 000 слотов выбранного события и первых 100 000 бронирований 
> соответствующего организатора. Перед поднятием этого лимита необходимо увеличить размер доступной приложению памяти 
> (heap).

Для того чтобы получить для конкретного события список слотов, которые не пересекаются с существующими бронированиями 
организатора, необходимо отправить запрос на ендпоинт GET http://localhost:8081/slots?eventId=ID_СОБЫТИЯ.
В ответе будут указаны:
- общее количество незанятых слотов, 
- первые 10 незанятых слотов, 
- время на загрузку слотов и бронирований из базы данных,
- время на фильтрацию незанятых слотов,
- общее время на формирование ответа:

```json
{
    "slotsFound": 50000,
    "firstPage": [
        {
            "id": 2,
            "eventId": 1,
            "startTime": "2025-07-28T01:00:00Z",
            "endTime": "2025-07-28T01:30:00Z"
        },
        {
            "id": 4,
            "eventId": 1,
            "startTime": "2025-07-28T08:15:00Z",
            "endTime": "2025-07-28T08:30:00Z"
        },
        {
            "id": 6,
            "eventId": 1,
            "startTime": "2025-07-28T14:45:00Z",
            "endTime": "2025-07-28T15:00:00Z"
        },
        {
            "id": 8,
            "eventId": 1,
            "startTime": "2025-07-28T19:00:00Z",
            "endTime": "2025-07-28T19:45:00Z"
        },
        {
            "id": 10,
            "eventId": 1,
            "startTime": "2025-07-28T23:30:00Z",
            "endTime": "2025-07-29T00:00:00Z"
        },
        {
            "id": 12,
            "eventId": 1,
            "startTime": "2025-07-29T07:15:00Z",
            "endTime": "2025-07-29T07:45:00Z"
        },
        {
            "id": 14,
            "eventId": 1,
            "startTime": "2025-07-29T12:45:00Z",
            "endTime": "2025-07-29T13:45:00Z"
        },
        {
            "id": 16,
            "eventId": 1,
            "startTime": "2025-07-29T18:45:00Z",
            "endTime": "2025-07-29T19:00:00Z"
        },
        {
            "id": 18,
            "eventId": 1,
            "startTime": "2025-07-30T03:45:00Z",
            "endTime": "2025-07-30T04:00:00Z"
        },
        {
            "id": 20,
            "eventId": 1,
            "startTime": "2025-07-30T08:45:00Z",
            "endTime": "2025-07-30T09:30:00Z"
        }
    ],
    "timeToLoadData": 172,
    "timeToCalculate": 2,
    "timeTotal": 174
}
```
